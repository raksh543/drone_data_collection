<!DOCTYPE html>
<html lang="en">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<head>
    <meta charset="UTF-8">
    <title>Colleting Data</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">

</head>
<body class="container" style="margin-top: 50px; width: 50%; height:auto;">
  <h2 class="text-primary" style="margin-left: 15px; margin-bottom: 10px">Hey There,Help Us In Collecting Data</h2>
    <form class="container" id="contactForm">
      <div class="card">
      <div class="card-body">
      <div class="form-group">
        <label for="exampleFormControlInput1">Enter Your Name</label>
        <input type="text" class="form-control" id="name" placeholder="Enter your name">
      </div>
      <div class="form-group">
        <label for="exampleFormControlInput1">Enter Your Roll</label>
        <input type="number" class="form-control" id="roll" placeholder="Roll Number">
      </div>
      <div class="form-group">
        <label for="exampleFormControlInput1">Email address</label>
        <input type="email" class="form-control" id="email" placeholder="name@example.com">
      </div>
      <div class="form-group">
        <label for="exampleFormControlSelect1">Example select</label>
    <!-- <select class="form-control" id="types">
      <option>1</option>
      <option>2</option>
      <option>3</option>
      <option>4</option>
      <option>5</option>
      <option>6</option>
      <option>7</option>
      <option>8</option>
      <option>9</option>
      <option>10</option>
    </select>
  </div>
<br> -->
    <!-- Document Upload: --><!-- 
    <br>
    <input type="file" name="files[]" id="files"> -->
    <!-- <input type="hidden" name="url" id="url">
    <br> -->
    <!-- <br>
 -->    
    <div id="fieldDiv" style="margin-bottom: 10px">
    	
    </div>
    <button type="button" onclick="addField()">Add More Video</button><br><br>
  </div>
</div>
<button type="button" onclick="uploadVideo()" class="btn btn-primary" style="margin-left: 15px; margin-top: 10px">Submit</button>

</form>
</body>
<script src="https://www.gstatic.com/firebasejs/3.7.4/firebase.js"></script>
<script>
   var firebaseConfig = {
    apiKey: "AIzaSyDejn6WX2l2Tru-VaxbKgVsS6Tj2EHqx7k",
    authDomain: "chatapplication-f88c0.firebaseapp.com",
    databaseURL: "https://chatapplication-f88c0.firebaseio.com",
    projectId: "chatapplication-f88c0",
    storageBucket: "chatapplication-f88c0.appspot.com",
    messagingSenderId: "1002691238689",
    appId: "1:1002691238689:web:052f3c5c6c7e188aaebc60"
  };
  firebase.initializeApp(firebaseConfig);
  var messagesRef = firebase.database().ref('Collected Data');
  // document.getElementById('contactForm').addEventListener('submit', submitForm);

  var numOfVideo = 0;
  function addField(){
  	numOfVideo++;
    console.log(`video` + numOfVideo)
  	var element = `
  	<div style="display: flex">
  	<div style="width: 30%;">
       <input id="video` + numOfVideo +  `" type="file" name="files[]">
  	</div>
  	<div style="width: 30%;"> 
  		 <select style={width: 50%} id="classSelector` + numOfVideo + `" class="form-control">
      <option>1</option>
      <option>2</option>
      <option>3</option>
      <option>4</option>
      <option>5</option>
      <option>6</option>
      <option>7</option>
      <option>8</option>
      <option>9</option>
      <option>10</option>
    </select>
  	</div>
  	</div>
   `
    $("#fieldDiv").append(element);
  }
 
  function uploadVideo(){
  	console.log("working")
  	console.log("")
  	var storage = firebase.storage();
   	var storageref=storage.ref();
   	for(let i=1; i<=numOfVideo; i++){
   		console.log("inside for loop")
      console.log(document.getElementById("video" + i))
		var file=document.getElementById("video" + i).files[0];
		var type = getInputVal('classSelector' + i);
 		var thisref=storageref.child(type).child(file.name).put(file);
  		thisref.on('state_changed',
  			function(snapshot) {}, 
  			function(error) {
  				alert("not done")
  				console.log("not done")
  			},
			function() {
       			// Uploaded completed successfully, now we can get the download URL
       			thisref.snapshot.ref.getDownloadURL().then(function(downloadURL) {
        			setDatabase(i,downloadURL);
        			alert('uploaded successfuly');
        			console.log("success")
       			});
    		}
    	);
	}
  }
function setDatabase(num,url){

  // Get values
  var name = getInputVal('name');
  var roll = getInputVal('roll');
  var email = getInputVal('email');
  var type = getInputVal('classSelector' + num);
  console.log("setting database")

  // Save message
  saveFileData(name, roll, email, url,type);

  // Show alert
  // Hide alert after 3 seconds


  // Clear form
  // document.getElementById('contactForm').reset();
}

// Function to get get form values
function getInputVal(id){
  return document.getElementById(id).value;
}

// Save message to firebase
function saveFileData(name, roll, email, url,type){
  var newMessageRef = messagesRef.child(email.slice('@')[0]).push();
  newMessageRef.set({
    name: name,
    roll:roll,
    email:email,
    videourl:url,
    class:type
  });
}
</script>
</html>